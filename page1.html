<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aura Solar Panel X | Technical Specifications</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .processing {
            animation: pulse 1.5s infinite;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-white text-gray-800">

    <!-- Assistant Button -->
    <div class="fixed top-20 right-4 z-50">
        <button id="assistant-button" class="bg-blue-600 text-white rounded-full p-4 shadow-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400">
            <!-- Mic Icon SVG -->
            <svg id="mic-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="22"></line></svg>
        </button>
        <div id="status-indicator" class="text-center text-xs text-gray-600 mt-1"></div>
    </div>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex-shrink-0">
                    <a href="index.html" class="flex items-center space-x-2">
                         <svg class="h-8 w-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                        <span class="text-2xl font-bold text-gray-800">Aura Energy</span>
                    </a>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="index.html" class="text-gray-600 hover:bg-blue-50 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        <a href="#" class="text-gray-600 hover:bg-blue-50 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">About Us</a>
                        <a href="#" class="text-gray-600 hover:bg-blue-50 hover:text-blue-600 px-3 py-2 rounded-md text-sm font-medium">Solutions</a>
                        <a href="#" class="bg-blue-600 text-white px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-700">Contact</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Page Title -->
    <header class="bg-gray-50 border-b border-gray-200">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <h1 class="text-3xl font-bold text-gray-900">
                Aura Solar Panel X: Technical Specifications
            </h1>
            <p class="mt-2 text-md text-gray-600">Model: AUR-SPX-450W | Last Updated: October 10, 2025</p>
        </div>
    </header>
    
    <!-- Main Content with Sidebar -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="lg:grid lg:grid-cols-4 lg:gap-8">
            
            <!-- Sidebar Navigation -->
            <aside class="hidden lg:block lg:col-span-1">
                <div class="sticky top-24">
                    <h3 class="font-semibold text-gray-800 mb-4">On this page</h3>
                    <nav class="flex flex-col space-y-2">
                        <a href="#overview" class="text-blue-600 hover:underline">Overview</a>
                        <a href="#electrical-specs" class="text-gray-600 hover:text-blue-600 hover:underline">Electrical Specifications</a>
                        <a href="#mechanical-specs" class="text-gray-600 hover:text-blue-600 hover:underline">Mechanical Data</a>
                        <a href="#certifications" class="text-gray-600 hover:text-blue-600 hover:underline">Certifications & Warranty</a>
                        <a href="#downloads" class="text-gray-600 hover:text-blue-600 hover:underline">Downloads</a>
                        <a href="#contact" class="text-gray-600 hover:text-blue-600 hover:underline">Request a Quote</a>
                    </nav>
                </div>
            </aside>

            <!-- Main technical content -->
            <div class="lg:col-span-3">
                <div class="prose prose-lg max-w-none">
                    
                    <section id="overview">
                        <h2>Overview</h2>
                        <p>The Aura Solar Panel X (Model AUR-SPX-450W) represents the pinnacle of photovoltaic technology. Engineered for maximum efficiency and durability, it utilizes next-generation monocrystalline PERC cells to deliver superior performance in all weather conditions. Its sleek, all-black design ensures a modern aesthetic suitable for both residential and commercial installations.</p>
                    </section>

                    <section id="electrical-specs" class="mt-12">
                        <h2>Electrical Specifications</h2>
                        <p>Performance data under Standard Test Conditions (STC: Irradiance 1000 W/m², Cell Temperature 25°C, Air Mass 1.5).</p>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Parameter</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Maximum Power (Pmax)</td><td class="px-6 py-4 whitespace-nowrap">450 W</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Maximum Power Voltage (Vmp)</td><td class="px-6 py-4 whitespace-nowrap">41.7 V</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Maximum Power Current (Imp)</td><td class="px-6 py-4 whitespace-nowrap">10.8 A</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Open Circuit Voltage (Voc)</td><td class="px-6 py-4 whitespace-nowrap">49.8 V</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Short Circuit Current (Isc)</td><td class="px-6 py-4 whitespace-nowrap">11.4 A</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Module Efficiency</td><td class="px-6 py-4 whitespace-nowrap">21.3%</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section id="mechanical-specs" class="mt-12">
                        <h2>Mechanical Data</h2>
                         <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Component</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Details</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Dimensions</td><td class="px-6 py-4 whitespace-nowrap">1903 x 1134 x 35 mm</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Weight</td><td class="px-6 py-4 whitespace-nowrap">23.5 kg</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Front Glass</td><td class="px-6 py-4 whitespace-nowrap">3.2mm, Anti-Reflection Coated, High Transmission, Tempered Glass</td></tr>
                                    <tr><td class="px-6 py-4 whitespace-nowrap">Frame</td><td class="px-6 py-4 whitespace-nowrap">Anodized Aluminium Alloy (Black)</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <section id="certifications" class="mt-12">
                        <h2>Certifications & Warranty</h2>
                        <ul>
                            <li><strong>Certifications:</strong> IEC 61215, IEC 61730, UL 61730, ISO 9001</li>
                            <li><strong>Product Warranty:</strong> 15-Year Enhanced Product Warranty</li>
                            <li><strong>Performance Warranty:</strong> 25-Year Linear Power Output Warranty</li>
                        </ul>
                    </section>

                    <section id="downloads" class="mt-12">
                         <h2>Downloads</h2>
                         <div class="flex space-x-4">
                             <a href="#" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-200">Datasheet (PDF)</a>
                             <a href="#" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-200">Installation Manual (PDF)</a>
                         </div>
                    </section>

                    <section id="contact" class="mt-16 bg-gray-50 p-8 rounded-lg">
                        <h2>Request a Quote</h2>
                        <p class="mb-4">Interested in the Aura Solar Panel X for your project? Fill out the form below and one of our specialists will get in touch.</p>
                        <form action="#" method="POST" class="space-y-4">
                            <div>
                                <label for="name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                <input type="text" id="name" name="name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                             <div>
                                <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                <input type="email" id="email" name="email" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                            </div>
                             <div>
                                <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                                <textarea id="message" name="message" rows="4" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"></textarea>
                            </div>
                            <div>
                                <button type="submit" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Submit Request
                                </button>
                            </div>
                        </form>
                    </section>

                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center">
            <p>&copy; 2025 Aura Energy Solutions. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        const assistantButton = document.getElementById('assistant-button');
        const statusIndicator = document.getElementById('status-indicator');
        const micIcon = document.getElementById('mic-icon');
        let audioPlayer = new Audio();
        let isSpeaking = false;
        let realtimeWebSocket = null;
        let clientSecret = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let silenceTimeout = null;
        let preloadedSummaryAudio = null;
        let isPreloaded = false;
        let preloadedSessionInfo = null;
        let isSessionPreloaded = false;

        // Preload summary audio and session on page load
        async function preloadSummary() {
            try {
                console.log("[PRELOAD] Starting to preload summary audio...");
                const response = await fetch('http://127.0.0.1:5000/summarize-and-speak', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page_name: 'page1.html' }),
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const audioBlob = await response.blob();
                const audioUrl = URL.createObjectURL(audioBlob);
                preloadedSummaryAudio = audioUrl;
                isPreloaded = true;
                console.log("[PRELOAD] ✅ Summary audio preloaded successfully!");
                
                // Also preload the session
                await preloadSession();
            } catch (error) {
                console.error("[PRELOAD] Error preloading summary:", error);
                isPreloaded = false;
            }
        }

        async function preloadSession() {
            try {
                console.log("[PRELOAD] Starting to preload session...");
                const response = await fetch('http://127.0.0.1:5000/create-talk-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page_name: 'page1.html' }),
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                preloadedSessionInfo = {
                    client_secret: data.client_secret,
                    model: data.model
                };
                isSessionPreloaded = true;
                console.log("[PRELOAD] ✅ Session preloaded successfully!");
            } catch (error) {
                console.error("[PRELOAD] Error preloading session:", error);
                isSessionPreloaded = false;
            }
        }

        // Preload on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                preloadSummary();
            }, 1000); // Wait 1 second after page load to avoid blocking
        });

        assistantButton.addEventListener('click', async () => {
            if (isSpeaking) return;

            // If we have an active realtime session, stop it
            if (realtimeWebSocket) {
                stopRealtimeSession();
                return;
            }

            // Use preloaded audio if available for instant playback
            if (isPreloaded && preloadedSummaryAudio) {
                console.log("[PRELOAD] Using preloaded summary audio - instant playback!");
                isSpeaking = true;
                updateUI(true, 'Speaking...');
                audioPlayer.src = preloadedSummaryAudio;
                audioPlayer.play();

                audioPlayer.onended = () => {
                    isSpeaking = false;
                    updateUI(false, '');
                    console.log("Summary finished. Creating Realtime session.");
                    createRealtimeSession();
                };
            } else {
                // Fallback: fetch summary if not preloaded
                isSpeaking = true;
                updateUI(true, 'Summarizing...');

                try {
                    const response = await fetch('http://127.0.0.1:5000/summarize-and-speak', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ page_name: 'page1.html' }),
                    });

                    if (!response.ok) {
                        throw new Error(`Server responded with ${response.status}`);
                    }

                    const audioBlob = await response.blob();
                    const audioUrl = URL.createObjectURL(audioBlob);
                    
                    audioPlayer.src = audioUrl;
                    audioPlayer.play();
                    updateUI(true, 'Speaking...');

                    audioPlayer.onended = () => {
                        isSpeaking = false;
                        updateUI(false, '');
                        URL.revokeObjectURL(audioUrl);
                        console.log("Summary finished. Creating Realtime session.");
                        createRealtimeSession();
                    };

                } catch (error) {
                    console.error('Error fetching or playing audio:', error);
                    updateUI(false, 'Error');
                    isSpeaking = false;
                }
            }
        });

        async function createRealtimeSession() {
            // Use preloaded session if available for faster connection
            if (isSessionPreloaded && preloadedSessionInfo) {
                console.log("[PRELOAD] Using preloaded session - instant connection!");
                clientSecret = preloadedSessionInfo.client_secret;
                const model = preloadedSessionInfo.model;
                
                console.log("Realtime session ready. Connecting to WebSocket...");
                await connectToRealtimeSession(model);
            } else {
                // Fallback: create session if not preloaded
                updateUI(true, 'Creating session...');
                try {
                    const response = await fetch('http://127.0.0.1:5000/create-talk-session', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ page_name: 'page1.html' }),
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    
                    const data = await response.json();
                    clientSecret = data.client_secret;
                    const model = data.model;
                    
                    console.log("Realtime session created. Connecting to WebSocket...");
                    await connectToRealtimeSession(model);
                    
                } catch (error) {
                    console.error("Error creating Realtime session:", error);
                    updateUI(false, 'Error creating session');
                }
            }
        }

        async function connectToRealtimeSession(model) {
            try {
                const wsUrl = `ws://127.0.0.1:5000/ws/realtime`;
                console.log("Connecting to WebSocket proxy:", wsUrl);
                realtimeWebSocket = new WebSocket(wsUrl);
                
                realtimeWebSocket.onopen = () => {
                    console.log("Connected to WebSocket proxy");
                    // Send client_secret, model, and page_name to proxy for authentication
                    realtimeWebSocket.send(JSON.stringify({
                        client_secret: clientSecret,
                        model: model,
                        page_name: 'page1.html'
                    }));
                    console.log("Sent client_secret, model, and page_name to proxy");
                    updateUI(false, 'Listening...');
                    startListening();
                };
                
                realtimeWebSocket.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleRealtimeMessage(data);
                };
                
                realtimeWebSocket.onclose = () => {
                    console.log("Realtime WebSocket closed");
                    updateUI(false, 'Session ended');
                };
                
                realtimeWebSocket.onerror = (error) => {
                    console.error("Realtime WebSocket error:", error);
                    updateUI(false, 'Connection error');
                };
                
            } catch (error) {
                console.error("Error connecting to Realtime session:", error);
                updateUI(false, 'Connection failed');
            }
        }

        function handleRealtimeMessage(data) {
            switch (data.type) {
                case 'session.created':
                    console.log("Session created successfully");
                    break;
                case 'session.updated':
                    console.log("Session updated successfully");
                    break;
                case 'conversation.item.input_audio_buffer.speech_started':
                    console.log("User started speaking");
                    break;
                case 'conversation.item.input_audio_buffer.speech_stopped':
                    console.log("User stopped speaking");
                    break;
                case 'conversation.item.output_audio_buffer.speech_started':
                    console.log("Assistant started speaking");
                    updateUI(false, 'Speaking...');
                    break;
                case 'conversation.item.output_audio_buffer.speech_stopped':
                    console.log("Assistant finished speaking");
                    updateUI(false, 'Listening...');
                    startListening();
                    break;
                case 'error':
                    console.error("Realtime API error:", data.error);
                    updateUI(false, 'Error');
                    break;
                default:
                    console.log("Received message:", data.type);
            }
        }

        async function sendAudioToRealtime(audioBlob) {
            if (!realtimeWebSocket || realtimeWebSocket.readyState !== WebSocket.OPEN) {
                console.error("Realtime WebSocket not connected");
                return;
            }
            
            try {
                // Convert audio blob to base64
                const arrayBuffer = await audioBlob.arrayBuffer();
                const base64Audio = btoa(String.fromCharCode(...new Uint8Array(arrayBuffer)));
                
                // Send audio data
                const message = {
                    type: "conversation.item.input_audio_buffer.append",
                    item: {
                        type: "input_audio_buffer",
                        audio: base64Audio
                    }
                };
                
                realtimeWebSocket.send(JSON.stringify(message));
                
                // Commit the audio buffer
                const commitMessage = {
                    type: "conversation.item.input_audio_buffer.commit"
                };
                
                realtimeWebSocket.send(JSON.stringify(commitMessage));
                console.log("Audio sent to Realtime API");
                
            } catch (error) {
                console.error("Error sending audio to Realtime:", error);
            }
        }

        async function startListening() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                audioChunks = [];

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                    clearTimeout(silenceTimeout);
                    silenceTimeout = setTimeout(() => {
                        if (mediaRecorder.state === 'recording') {
                            mediaRecorder.stop();
                        }
                    }, 1500);
                };
                
                mediaRecorder.onstop = async () => {
                    stream.getTracks().forEach(track => track.stop());
                    
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    
                    if (audioBlob.size > 100) {
                        await sendAudioToRealtime(audioBlob);
                    } else {
                        console.log("No speech detected, listening again.");
                        startListening();
                    }
                };

                mediaRecorder.start();
                silenceTimeout = setTimeout(() => {
                    if (mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                    }
                }, 2000);

            } catch (error) {
                console.error("Microphone error:", error);
                updateUI(false, 'Mic access denied');
            }
        }

        function stopRealtimeSession() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
            }
            if (realtimeWebSocket) {
                realtimeWebSocket.close();
                realtimeWebSocket = null;
            }
            clearTimeout(silenceTimeout);
            updateUI(false, '');
            console.log("Realtime session stopped by user.");
        }

        function updateUI(isProcessing, statusText) {
            statusIndicator.textContent = statusText;
            assistantButton.disabled = isProcessing;
            if (isProcessing) {
                micIcon.classList.add('text-yellow-300', 'processing');
            } else {
                micIcon.classList.remove('text-yellow-300', 'processing');
            }
        }
    </script>
</body>
</html>

